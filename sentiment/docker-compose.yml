version: "3"

services:
  frontend:
    image: frontend:latest
    ports:
      - "80:80"
    networks:
      sentiment:
        ipv4_address: 172.16.238.9
    deploy:
      replicas: 1
      update_config:
        parallelism: 2
        delay: 10s
      restart_policy:
        condition: always

  webapp:
    image: webapp:latest
    environment:
      LOGIC_API_URL: "http://172.16.238.10:5000"
    ports:
      - "8080:8080"
    networks:
      sentiment:
        ipv4_address: 172.16.238.11
    depends_on:
      - logic
    deploy:
      replicas: 1
      update_config:
        parallelism: 1
      restart_policy:
        condition: always

  logic:
    image: logic:latest
    ports:
      - "5000:5000"
    networks:
      sentiment:
        ipv4_address: 172.16.238.10
    deploy:
      replicas: 1
      update_config:
        parallelism: 1
      restart_policy:
        condition: always

networks:
  sentiment:
    ipam:
      driver: default
      config:
        - subnet: "172.16.238.0/24"
